<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>实现基于 key 批量验证的脚本</title>
      <link href="/posts/64549/"/>
      <url>/posts/64549/</url>
      
        <content type="html"><![CDATA[<p><strong>自动化运维工具ansible需要基于ssh key验证免密登录。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#author: 9528</span></span><br><span class="line"><span class="comment">#mail： scsc4212@163.com</span></span><br><span class="line"><span class="comment">#date: 2019-7-24</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#简述：</span></span><br><span class="line"><span class="comment">#脚本实现批量推送公钥，实现ssh key验证免密登陆，ip地址由ip.txt文件</span></span><br><span class="line"><span class="comment">#导入，success_ip.txt存放推送成功的ip地址，failed_ip.txt存放推送失败的ip</span></span><br><span class="line"><span class="comment">#地址。</span></span><br><span class="line"><span class="comment">#    </span></span><br><span class="line"><span class="comment">#       待改进：</span></span><br><span class="line"><span class="comment">#            明文存放密码风险</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#========================================================================</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"> </span><br><span class="line">. /etc/init.d/functions</span><br><span class="line"><span class="comment">#被推送主机的密码</span></span><br><span class="line">password=<span class="string">&quot;7654321&quot;</span>  </span><br><span class="line"><span class="comment">#创建文件,存放推送成功的ip</span></span><br><span class="line">&gt;success_ip.txt</span><br><span class="line"><span class="comment">#创建文件,存放推送失败的ip</span></span><br><span class="line">&gt;failed_ip.txt</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#检查是否按照了expect软件包</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">rpm -q expect &amp;&gt;/dev/null || (<span class="built_in">echo</span> <span class="string">&quot;------start install expect!------&quot;</span> &amp;&amp; yum install expect -y &amp;&gt; /dev/null)</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31m------install expect failed!------\033[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31m------end exit!------\033[0m&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#检查本机密钥是否丢失，若丢失则重新生成密钥</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f ~/.ssh/id_rsa ] || [ ! -f ~/.ssh/id_rsa.pub ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">rm</span> -f ~/.ssh/id_rsa*</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------start ssh-keygen!------&quot;</span></span><br><span class="line">ssh-keygen -P <span class="string">&quot;&quot;</span> -f ~/.ssh/id_rsa &amp;&gt; /dev/null </span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31m------ssh-keygen failed!------\033[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[31m------end exit!------\033[0m&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#检查ip是否能ping通，能ping通才推送秘钥</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------start ssh-copy-id!------&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> ip</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">ping -c1 -W3 <span class="variable">$ip</span> &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">expect &amp;&gt; key.log &lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string">spawn ssh-copy-id $ip</span></span><br><span class="line"><span class="string">set timeout 10</span></span><br><span class="line"><span class="string">expect &#123;</span></span><br><span class="line"><span class="string">&quot;yes/no&quot; &#123; send &quot;yes\r&quot;; exp_continue&#125;</span></span><br><span class="line"><span class="string">&quot;password&quot; &#123; send &quot;$password\r&quot; &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">expect eof</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">sleep</span> 0.5</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#通过每次执行后的信息区分下面三种情况：</span></span><br><span class="line"><span class="comment">#1.正常推送成功</span></span><br><span class="line"><span class="comment">#2.原来的密钥已推送过，这种情况我们也标记成推送成功</span></span><br><span class="line"><span class="comment">#3.password验证错误导致推送失败</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> fgrep -q <span class="string">&quot;try logging into the machine&quot;</span> key.log</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ip</span> &gt;&gt; success_ip.txt</span><br><span class="line">action <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> /bin/true</span><br><span class="line"><span class="keyword">elif</span> fgrep -q <span class="string">&quot;they already exist on the remote system.&quot;</span> key.log</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ip</span> &gt;&gt; success_ip.txt</span><br><span class="line">action <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> /bin/true</span><br><span class="line"><span class="keyword">else</span> fgrep -q <span class="string">&quot;Permission denied, please try again.&quot;</span> key.log</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ip</span> &gt;&gt; failed_ip.txt</span><br><span class="line">action <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> /bin/false</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#ping不通的情况</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">action <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> /bin/false</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ip</span> &gt;&gt; failed_ip.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; ip.txt</span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n\033[34m------------finish!------------\033[0m\n&quot;</span></span><br></pre></td></tr></table></figure><p><strong>执行结果</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="variable">$bash</span>  key.sh</span><br><span class="line">------start install expect!------</span><br><span class="line">------start ssh-keygen!------</span><br><span class="line">------start ssh-copy-id!------</span><br><span class="line">192.168.1.77                                               [  OK  ]</span><br><span class="line">192.168.1.88                                               [  OK  ]</span><br><span class="line"> </span><br><span class="line">------------finish!------------</span><br></pre></td></tr></table></figure><p>产生的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 脚本 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脚本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>几个shell脚本</title>
      <link href="/posts/38236/"/>
      <url>/posts/38236/</url>
      
        <content type="html"><![CDATA[<blockquote><p>几个Linux小脚本~~</p></blockquote><h2 id="实现基于key验证的脚本"><a href="#实现基于key验证的脚本" class="headerlink" title="实现基于key验证的脚本"></a>实现基于key验证的脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#StrictHostKeyChecking=no为关闭第一次连接的回答</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">IPLIST=<span class="string">&quot;</span></span><br><span class="line"><span class="string">10.0.0.112</span></span><br><span class="line"><span class="string">10.0.0.115</span></span><br><span class="line"><span class="string">10.0.0.116</span></span><br><span class="line"><span class="string">10.0.0.117&quot;</span></span><br><span class="line">rpm -q sshpass &amp;&gt; /dev/null || yum -y install sshpass</span><br><span class="line">[ -f /root/.ssh/id_rsa ] || ssh-keygen -f /root/.ssh/id_rsa -P <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">export</span> SSHPASS=988771</span><br><span class="line"><span class="keyword">for</span> IP <span class="keyword">in</span> <span class="variable">$IPLIST</span>;<span class="keyword">do</span></span><br><span class="line">   sshpass -e ssh-copy-id -o StrictHostKeyChecking=no <span class="variable">$IP</span>                                                                            </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="LVS-DR模式初始化脚本"><a href="#LVS-DR模式初始化脚本" class="headerlink" title="LVS_DR模式初始化脚本"></a>LVS_DR模式初始化脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#LVS_DR模式初始化脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">vip=10.0.0.100   <span class="comment">#keepalived的vip</span></span><br><span class="line">mask=<span class="string">&#x27;255.255.255.255&#x27;</span></span><br><span class="line">dev=lo:0</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">    <span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">    <span class="built_in">echo</span> 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">    ifconfig <span class="variable">$dev</span> <span class="variable">$vip</span> netmask <span class="variable">$mask</span> broadcast <span class="variable">$vip</span></span><br><span class="line">    route add -host <span class="variable">$vip</span> dev <span class="variable">$dev</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The RS Server is Ready!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">stop)</span><br><span class="line">    ifconfig <span class="variable">$dev</span> down</span><br><span class="line">    route del <span class="variable">$vip</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">    <span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">    <span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">    <span class="built_in">echo</span> 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The RS Server is Canceled!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">*) </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="subst">$(basename $0)</span> start|stop&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span> </span><br></pre></td></tr></table></figure><h2 id="在线安装haproxy脚本"><a href="#在线安装haproxy脚本" class="headerlink" title="在线安装haproxy脚本"></a>在线安装haproxy脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Date: 2021-4-11</span></span><br><span class="line"><span class="comment">#Version: v1.0</span></span><br><span class="line"></span><br><span class="line">FILE_DIR=<span class="string">&quot;/usr/local/src&quot;</span></span><br><span class="line">LUA_PKG=<span class="string">&quot;lua-5.4.3.tar.gz&quot;</span></span><br><span class="line">LUA_DIR=<span class="string">&quot;lua-5.4.3&quot;</span></span><br><span class="line">HAPROXY_PKG=<span class="string">&quot;haproxy-2.2.13.tar.gz&quot;</span></span><br><span class="line">HAPROXY_DIR=<span class="string">&quot;haproxy-2.2.13&quot;</span></span><br><span class="line">HAPROXY_VER=<span class="string">&quot;2.2.13&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install_system_package</span></span>()&#123;</span><br><span class="line">  grep <span class="string">&quot;Ubuntu&quot;</span> /etc/issue &amp;&gt; /dev/null</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;开始安装依赖&quot;</span></span><br><span class="line">    apt update</span><br><span class="line">    apt  install iproute2  ntpdate make  tcpdump telnet traceroute nfs-kernel-server nfs-common  lrzsz tree  openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute  gcc openssh-server lrzsz tree  openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev ntpdate tcpdump telnet traceroute iotop unzip zip  libreadline-dev libsystemd-dev -y &amp;&gt; /dev/null</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  grep <span class="string">&quot;Kernel&quot;</span> /etc/issue &amp;&gt; /dev/null</span><br><span class="line">  <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;开始安装依赖&quot;</span></span><br><span class="line">    yum install  vim iotop bc gcc gcc-c++ glibc glibc-devel pcre  pcre-devel openssl  openssl-devel zip unzip zlib-devel  net-tools lrzsz tree ntpdate telnet lsof tcpdump wget libevent libevent-devel bc  systemd-devel bash-completion traceroute psmisc -y  &amp;&gt; /dev/null</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">haproxy_cfg</span></span>()&#123;</span><br><span class="line">  <span class="built_in">mkdir</span> -p /etc/haproxy</span><br><span class="line">  <span class="built_in">cat</span> &gt; /etc/haproxy/haproxy.cfg &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">global</span></span><br><span class="line"><span class="string">maxconn 100000</span></span><br><span class="line"><span class="string">chroot /apps/haproxy</span></span><br><span class="line"><span class="string">stats socket /var/lib/haproxy/haproxy.sock mode 600 level admin</span></span><br><span class="line"><span class="string">uid 99</span></span><br><span class="line"><span class="string">gid 99</span></span><br><span class="line"><span class="string">daemon</span></span><br><span class="line"><span class="string">#nbproc 4</span></span><br><span class="line"><span class="string">#cpu-map 1 0</span></span><br><span class="line"><span class="string">#cpu-map 2 1</span></span><br><span class="line"><span class="string">#cpu-map 3 2</span></span><br><span class="line"><span class="string">#cpu-map 4 3</span></span><br><span class="line"><span class="string">pidfile /var/lib/haproxy/haproxy.pid</span></span><br><span class="line"><span class="string">log 127.0.0.1 local3 info</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">defaults</span></span><br><span class="line"><span class="string">option http-keep-alive</span></span><br><span class="line"><span class="string">option forwardfor</span></span><br><span class="line"><span class="string">maxconn 100000</span></span><br><span class="line"><span class="string">mode http</span></span><br><span class="line"><span class="string">timeout connect 300000ms</span></span><br><span class="line"><span class="string">timeout client 300000ms</span></span><br><span class="line"><span class="string">timeout server 300000ms</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">listen stats</span></span><br><span class="line"><span class="string">mode http</span></span><br><span class="line"><span class="string">bind 0.0.0.0:9999</span></span><br><span class="line"><span class="string">stats enable</span></span><br><span class="line"><span class="string">log global</span></span><br><span class="line"><span class="string">stats uri /haproxy-status</span></span><br><span class="line"><span class="string">stats auth haadmin:123456</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">listen web_port</span></span><br><span class="line"><span class="string">bind 0.0.0.0:80</span></span><br><span class="line"><span class="string">mode http</span></span><br><span class="line"><span class="string">log global</span></span><br><span class="line"><span class="string">server web1 127.0.0.1:8080 check inter 3000 fall 2 rise 5</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/haproxy.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=HAProxy Load Balancer</span></span><br><span class="line"><span class="string">After=syslog.target network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStartPre=/apps/haproxy/sbin/haproxy -f /etc/haproxy/haproxy.cfg -c -q</span></span><br><span class="line"><span class="string">ExecStart=/apps/haproxy/sbin/haproxy -Ws -f /etc/haproxy/haproxy.cfg -p /var/lib/haproxy/haproxy.pid</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -USR2 \$MAINPID</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install_lua</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;开始安装lua5.4.3&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$&#123;FILE_DIR&#125;</span> &amp;&amp; wget http://www.lua.org/ftp/<span class="variable">$&#123;LUA_PKG&#125;</span> &amp;&amp; tar xvf <span class="variable">$&#123;LUA_PKG&#125;</span> &amp;&amp; <span class="built_in">cd</span>  <span class="variable">$&#123;LUA_DIR&#125;</span> &amp;&amp; make linux <span class="built_in">test</span> &amp;&gt; /dev/null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">install_haproxy</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;开始安装haproxy2.2&quot;</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p /var/lib/haproxy</span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$&#123;FILE_DIR&#125;</span> &amp;&amp; wget https://www.haproxy.org/download/2.2/src/<span class="variable">$&#123;HAPROXY_PKG&#125;</span> &amp;&amp; tar xvf  <span class="variable">$&#123;HAPROXY_PKG&#125;</span> &amp;&amp; <span class="built_in">cd</span> <span class="variable">$&#123;HAPROXY_DIR&#125;</span> &amp;&amp; make  ARCH=x86_64 TARGET=linux-glibc  USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1  USE_SYSTEMD=1  USE_CPU_AFFINITY=1 USE_LUA=1 LUA_INC=<span class="variable">$&#123;FILE_DIR&#125;</span>/<span class="variable">$&#123;LUA_DIR&#125;</span>/src/  LUA_LIB=<span class="variable">$&#123;FILE_DIR&#125;</span>/<span class="variable">$&#123;LUA_DIR&#125;</span>/src/ PREFIX=/apps/haproxy &amp;&amp; make install PREFIX=/apps/haproxy &amp;&gt; /dev/null &amp;&amp; <span class="built_in">cp</span> haproxy  /usr/sbin/</span><br><span class="line">    systemctl daemon-reload &amp;&amp; systemctl restart haproxy &amp;&amp; systemctl <span class="built_in">enable</span> haproxy</span><br><span class="line">    killall -0 haproxy</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;HAProxy <span class="variable">$&#123;HAPROXY_VER&#125;</span> 安装成功!&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;即将退出安装过程!&quot;</span> &amp;&amp; <span class="built_in">sleep</span> 1</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;HAProxy <span class="variable">$&#123;HAPROXY_VER&#125;</span> 安装失败!&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;即将退出安装过程!&quot;</span> &amp;&amp; <span class="built_in">sleep</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">  install_system_package</span><br><span class="line">  install_lua</span><br><span class="line">  haproxy_cfg</span><br><span class="line">  install_haproxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure><h2 id="自动检测连接数过多的连接"><a href="#自动检测连接数过多的连接" class="headerlink" title="自动检测连接数过多的连接"></a>自动检测连接数过多的连接</h2><p>每十分钟检查将连接数超过100个以上的IP放入黑名单拒绝访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim  deny_dos.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">LINK=100</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"> ss -nt | awk -F<span class="string">&quot;[[:space:]]+|:&quot;</span> <span class="string">&#x27;/^ESTAB/&#123;print $(NF-2)&#125;&#x27;</span>|<span class="built_in">sort</span> |<span class="built_in">uniq</span> -</span><br><span class="line">c|<span class="keyword">while</span> <span class="built_in">read</span> count ip;<span class="keyword">do</span> </span><br><span class="line"> <span class="keyword">if</span> [ <span class="variable">$count</span> -gt <span class="variable">$LINK</span> ];<span class="keyword">then</span></span><br><span class="line">   iptables -A INPUT -s <span class="variable">$ip</span> -j REJECT</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /root/deny_dos.sh</span><br><span class="line">crontab -e</span><br><span class="line">crontab -l </span><br><span class="line">*/10 * * * *   /root/deny_dos.sh</span><br></pre></td></tr></table></figure><h2 id="显示系统信息的脚本"><a href="#显示系统信息的脚本" class="headerlink" title="显示系统信息的脚本"></a>显示系统信息的脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim systeminfo.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">RED=<span class="string">&quot;\E[1;31m&quot;</span></span><br><span class="line">GREEN=<span class="string">&quot;\E[1;32m&quot;</span></span><br><span class="line">END=<span class="string">&quot;\E[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;<span class="variable">$GREEN</span>----------------------Host systeminfo--------------------<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;HOSTNAME:     <span class="variable">$RED</span>`hostname`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;IPADDR:       <span class="variable">$RED</span>` ifconfig eth0|grep -Eo &#x27;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&#x27; |head -n1`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;OSVERSION:    <span class="variable">$RED</span>`cat /etc/redhat-release`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;KERNEL:       <span class="variable">$RED</span>`uname -r`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;CPU:         <span class="variable">$RED</span>`lscpu|grep &#x27;Model name&#x27;|tr -s &#x27; &#x27;|cut -d : -f2`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;MEMORY:       <span class="variable">$RED</span>`free -h|grep Mem|tr -s &#x27; &#x27; : |cut -d : -f2`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;DISK:         <span class="variable">$RED</span>`lsblk |grep &#x27;^sd&#x27; |tr -s &#x27; &#x27; |cut -d &quot;</span> <span class="string">&quot; -f4`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;<span class="variable">$GREEN</span>---------------------------------------------------------<span class="variable">$END</span>&quot;</span></span><br></pre></td></tr></table></figure><h2 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装tomcat</h2><p>需在脚本目录中准备好jdk和tomcat二进制文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">DIR=`<span class="built_in">pwd</span>`</span><br><span class="line">JDK_FILE=<span class="string">&quot;jdk-8u281-linux-x64.tar.gz&quot;</span></span><br><span class="line">TOMCAT_FILE=<span class="string">&quot;apache-tomcat-8.5.64.tar.gz&quot;</span></span><br><span class="line">JDK_DIR=<span class="string">&quot;/usr/local&quot;</span></span><br><span class="line">TOMCAT_DIR=<span class="string">&quot;/usr/local&quot;</span></span><br><span class="line"><span class="comment">#颜色</span></span><br><span class="line"><span class="function"><span class="title">color</span></span> () &#123;</span><br><span class="line">    RES_COL=60</span><br><span class="line">    MOVE_TO_COL=<span class="string">&quot;echo -en \\033[<span class="variable">$&#123;RES_COL&#125;</span>G&quot;</span></span><br><span class="line">    SETCOLOR_SUCCESS=<span class="string">&quot;echo -en \\033[1;32m&quot;</span></span><br><span class="line">    SETCOLOR_FAILURE=<span class="string">&quot;echo -en \\033[1;31m&quot;</span></span><br><span class="line">    SETCOLOR_WARNING=<span class="string">&quot;echo -en \\033[1;33m&quot;</span></span><br><span class="line">    SETCOLOR_NORMAL=<span class="string">&quot;echo -en \E[0m&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$2</span>&quot;</span> &amp;&amp; <span class="variable">$MOVE_TO_COL</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;[&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> = <span class="string">&quot;success&quot;</span> -o <span class="variable">$1</span> = <span class="string">&quot;0&quot;</span> ] ;<span class="keyword">then</span></span><br><span class="line">       <span class="variable">$&#123;SETCOLOR_SUCCESS&#125;</span></span><br><span class="line">       <span class="built_in">echo</span> -n $<span class="string">&quot; OK &quot;</span></span><br><span class="line">    <span class="keyword">elif</span> [ <span class="variable">$1</span> = <span class="string">&quot;failure&quot;</span> -o <span class="variable">$1</span> = <span class="string">&quot;1&quot;</span> ] ;<span class="keyword">then</span></span><br><span class="line">       <span class="variable">$&#123;SETCOLOR_FAILURE&#125;</span></span><br><span class="line">       <span class="built_in">echo</span> -n $<span class="string">&quot;FAILED&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">       <span class="variable">$&#123;SETCOLOR_WARNING&#125;</span></span><br><span class="line">       <span class="built_in">echo</span> -n $<span class="string">&quot;WARNING&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$&#123;SETCOLOR_NORMAL&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;]&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">#安装jdk函数</span></span><br><span class="line"><span class="function"><span class="title">install_jdk</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> ! [ -f <span class="string">&quot;<span class="variable">$DIR</span>/<span class="variable">$JDK_FILE</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    color 1 <span class="string">&quot;<span class="variable">$JDK_FILE</span> 文件不存在&quot;</span></span><br><span class="line">    <span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">elif</span> [ -d <span class="variable">$JDK_DIR</span>/jdk ];<span class="keyword">then</span></span><br><span class="line">    color 1 <span class="string">&quot;JDK 已经安装&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">[ -d <span class="string">&quot;<span class="variable">$JDK_DIR</span>&quot;</span> ] || <span class="built_in">mkdir</span> -pv <span class="variable">$JDK_DIR</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tar xvf <span class="variable">$DIR</span>/<span class="variable">$JDK_FILE</span> -C <span class="variable">$JDK_DIR</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$JDK_DIR</span> &amp;&amp; <span class="built_in">ln</span> -s jdk1.8.* jdk</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/profile.d/jdk.sh &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">export JAVA_HOME=$JDK_DIR/jdk</span></span><br><span class="line"><span class="string">export JRE_HOME=\$JAVA_HOME/jre</span></span><br><span class="line"><span class="string">export CLASSPATH=\$JAVA_HOME/lib/:\$JRE_HOME/lib/</span></span><br><span class="line"><span class="string">export PATH=\$PATH:\$JAVA_HOME/bin</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">. /etc/profile.d/jdk.sh</span><br><span class="line">java -version &amp;&amp; color 0 <span class="string">&quot;JDK 安装完成&quot;</span> || &#123; color 1 <span class="string">&quot;JDK 安装失败&quot;</span> ; <span class="built_in">exit</span>; &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">#安装tomcat</span></span><br><span class="line"><span class="function"><span class="title">install_tomcat</span></span>()&#123;</span><br><span class="line"><span class="keyword">if</span> ! [ -f <span class="string">&quot;<span class="variable">$DIR</span>/<span class="variable">$TOMCAT_FILE</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">   color 1 <span class="string">&quot;<span class="variable">$TOMCAT_FILE</span> 文件不存在&quot;</span></span><br><span class="line">   <span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">elif</span> [ -d <span class="variable">$TOMCAT_DIR</span>/tomcat ];<span class="keyword">then</span></span><br><span class="line">   color 1 <span class="string">&quot;TOMCAT 已经安装&quot;</span></span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   [ -d <span class="string">&quot;<span class="variable">$TOMCAT_DIR</span>&quot;</span> ] || <span class="built_in">mkdir</span> -pv <span class="variable">$TOMCAT_DIR</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">tar xf <span class="variable">$DIR</span>/<span class="variable">$TOMCAT_FILE</span> -C <span class="variable">$TOMCAT_DIR</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$TOMCAT_DIR</span> &amp;&amp; <span class="built_in">ln</span> -s apache-tomcat-*/ tomcat</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;PATH=<span class="variable">$TOMCAT_DIR</span>/tomcat/bin:&quot;</span><span class="string">&#x27;$PATH&#x27;</span> &gt; /etc/profile.d/tomcat.sh</span><br><span class="line"><span class="built_in">id</span> tomcat &amp;&gt; /dev/null || useradd -r -s /sbin/nologin tomcat</span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$TOMCAT_DIR</span>/tomcat/conf/tomcat.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">JAVA_HOME=$JDK_DIR/jdk</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">chown</span> -R tomcat.tomcat <span class="variable">$TOMCAT_DIR</span>/tomcat/</span><br><span class="line"><span class="built_in">cat</span> &gt; /lib/systemd/system/tomcat.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Tomcat</span></span><br><span class="line"><span class="string">#After=syslog.target network.target remote-fs.target nss-lookup.target</span></span><br><span class="line"><span class="string">After=syslog.target network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">EnvironmentFile=$TOMCAT_DIR/tomcat/conf/tomcat.conf</span></span><br><span class="line"><span class="string">ExecStart=$TOMCAT_DIR/tomcat/bin/startup.sh</span></span><br><span class="line"><span class="string">ExecStop=$TOMCAT_DIR/tomcat/bin/shutdown.sh</span></span><br><span class="line"><span class="string">RestartSec=3</span></span><br><span class="line"><span class="string">PrivateTmp=true</span></span><br><span class="line"><span class="string">User=tomcat</span></span><br><span class="line"><span class="string">Group=tomcat</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> --now tomcat.service &amp;&gt; /dev/null</span><br><span class="line">systemctl is-active tomcat.service &amp;&gt; /dev/null &amp;&amp; color 0 <span class="string">&quot;TOMCAT 安装完成&quot;</span> || &#123; color 1 <span class="string">&quot;TOMCAT 安装失败&quot;</span> ; <span class="built_in">exit</span>; &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">install_jdk</span><br><span class="line">install_tomcat</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/16107/"/>
      <url>/posts/16107/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
